/*! ngFirewall v0.0.4 | https://github.com/coma/ngFirewall | MIT license */
!function(){var ngFirewall=angular.module("ngFirewall",[]),_logoutPath="/login",_routeFirewall={},_httpFirewall={},isResourceDenied=function(user,resource,firewall){var pattern,test=null;for(pattern in firewall)if(new RegExp(pattern).test(resource)){test=firewall[pattern];break}return null===test?!1:(test.constructor===String&&(test=[test]),test.constructor===Array?!test.some(function(role){return user.hasRole(role)}):test.constructor===Function?!test(user,resource):!1)};ngFirewall.provider("$auth",function(){var self=this;this.setLogoutPath=function(path){return _logoutPath=path,self},this.setRouteFirewall=function(firewall){return _routeFirewall=firewall,self},this.setHTTPFirewall=function(firewall){return _httpFirewall=firewall,self},this.$get=[function(){}]}),ngFirewall.service("$user",function(){var _roles=[];this.setRoles=function(roles){_roles=roles},this.hasRole=function(role){return _roles.indexOf(role)>-1},this.eraseRoles=function(){_roles=[]}}),ngFirewall.config(function($provide,$httpProvider){$provide.factory("firewallInterceptor",function($q,$user){return{request:function(config){if(isResourceDenied($user,config.url,_httpFirewall)){var canceler=$q.defer();config.timeout=canceler.promise,canceler.resolve()}return config||$q.when(config)}}}),$httpProvider.interceptors.push("firewallInterceptor")}),ngFirewall.run(function($rootScope,$auth,$user,$location){$rootScope.$on("$locationChangeStart",function(event,next){var resource=/[^#]#(.*)$/.exec(next);resource=null===resource?"":resource.pop(),isResourceDenied($user,resource,_routeFirewall)&&($user.eraseRoles(),$location.path(_logoutPath))})})}();